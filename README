This ansible playbook is designed for repo based Quobyte installations on nodes with Internet access. The playbook install-quobyte-server will install and configure prerequisites before installing and configuring a Quobyte cluster that can immediately be used for writing data (batteries included).

The Quobyte client will be installed on the storage nodes, additional clients can be installed using the install-quobyte-client playbook by populating the client nodes in the [clients] section of the inventory file.

Terminology:

[bootstrap] description
The bootstrap node is the first node in the cluster
There can only be one bootstrap node
The bootstrap node also has registry, metadata and data services installed

[bootstrap] requirements
Has CentOS 7 or Ubuntu 18 up and running
Requires an Ansible management node or the first node in the Quobyte cluster to have ansible installed
Has root or sudoers access to all nodes and clients that should be part of the cluster
Has passwordless key access to all cluster and client nodes
The host key for all cluster and client nodes has been accepted or checking has been disabled
Has a root or sudors account configured used to allow management via ansible

[reg_nodes] description
The registry nodes are used for service lookup, it can be compaired to a lightweight DNS server
The bootstrap node is the first registry server in the cluster
It is recommended to have a total of 3 to 5 registry servers in the cluster
Registry nodes also have metadata and data services installed

[reg_nodes] requirements
Has CentOS 7 or Ubuntu 18 up and running
A server that fulfills the minimal requirements to become a quobyte node
Has a root or sudors account configured used to allow management via ansible

[std_nodes] description
You can have as many cluster nodes as you want
Cluster nodes have metadata and data services installed
If you only have 4 nodes in the cluster you might not have any entries here but only in bootstrap and reg_nodes

[std_nodes requirements
Has CentOS 7 or Ubuntu 18 up and running
A server that fulfills the minimal requirements to become a quobyte node
Has a root or sudors account configured used to allow management via ansible

Preparation:

1) All devices (ssd,nvme,hdd) that will be used for Quobyte should be completly wiped or new 
   Please use 'wipefs -av' to clean repurposed devices

2) Edit the inventory file
 a) In section [bootstrap] put one Cluster Node by name
 b) In section [reg_nodes] put additional registry nodes here 2 entries here will result in a total of 3 registry servers (including bootstrap) (one per line)
 c) In section [std_nodes] put all additional nodes (if any) that should be added to the cluster (one per line)
 d) In section [clients] put all Client Nodes by name (one per line) (Cluster nodes already have the client installed)

3) Edit vars/quobyte.yaml
   Set the variables to a meaningful value for your environment
 a) repository: The Quobyte repo id that you have received after signing up on www.quobyte.com
 b) registry: The DNS A record for service discovery (example: registry.quobyte.local)
 c) mddisksize: The size of the flash device used for metadata on each node, example 1.2T (output size from lsblk) (only required when using [diskformat])
 d) mountpoint: Mountpoint name for the Quobyte client (example: /quobyte)
 e) network: Specify the preffered network for traffic, usually this is the physical or logical interface with the most bandwidth
 f) s3_endpoint: dns name for s3 usage

4) Start Quobyte server installation
   Within the quobyte-ansible directory run the following command on the Ansible management node or the Bootstrap node of the Quobyte cluster
   ansible-playbook -i inventory install-quobyte-server.yaml

5) Start Quobyte client installation
   Within the quobyte-ansible directory run the following command on the Ansible management node or the Bootstrap node of the Quobyte cluster
   ansible-playbook -i inventory install-quobyte-client.yaml

6) Cleanup Quobyte server installation
   Within the quobyte-ansible directory run the following command on the Ansible management node or the Bootstrap node of the Quobyte cluster
   ansible-playbook -i inventory clean-quobyte-server.yaml

7) Cleanup Quobyte client installation
   Within the quobyte-ansible directory run the following command on the Ansible management node or the Bootstrap node of the Quobyte cluster
   ansible-playbook -i inventory clean-quobyte-client.yaml
